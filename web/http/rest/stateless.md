# Stateless

상태 없음(Stateless) 제약조건은 **웹 서버가 클라이언트의 상태를 관리할 필요가 없다는 의미**다. 따라서 각 클라이언트는 웹 서버와 상호작용하는 관련 상황 정보를 직접 관리해야 한다. **웹 서버는 웹 애플리케이션과의 복잡한 커뮤니케이션을 위해 필요한 상태 관리를 클라이언트에 맡김으로써 더 많은 클라이언트에 서비스할 수 있다.** 이러한 트레이드오프는 웹 구조적인 스타일의 확장성에 이바지하는 주요 요소이다.

## Stateful, Stateless 차이

Stateful, Stateless의 차이는 아래와 같은 예로 이해할 수 있다.

### 상태 유지 - Stateful

```
고객: 이 **노트북** 얼마인가요?
점원: 100만원 입니다.

고객: **2개** 구매하겠습니다.
점원: 200만원 입니다. **신용카드, 현금중**에 어떤 걸로 구매 하시겠어요?

고객: 신용카드로 구매하겠습니다.
**점원: 200만원 결제 완료되었습니다.**
```

### 무상태 - Stateless, 점원이 중간에 바뀌면?

```
고객: 이 **노트북** 얼마인가요?
점원A: 100만원 입니다.

고객: **2개** 구매하겠습니다.
점원B: ? 무엇을 2개 구매하시겠어요?

고객: 신용카드로 구매하겠습니다.
점원C: ? 무슨 제품을 몇 개 신용카드로 구매하시겠어요?
```

상태(문맥)를 유지하지 않을 경우에는, 고객은 다음과 같이 요청(request)해야 한다.

```
고객: 이 **노트북** 얼마인가요?
점원**A**: 100만원 입니다.

고객: **노트북 2개** 구매하겠습니다.
점원**B**: 노트북 2개는 200만원 입니다. **신용카드, 현금중**에 어떤 걸로 구매 하시겠어요?

고객: **노트북 2개를 신용카드**로 구매하겠습니다.
점원**C**: 200만원 결제 완료되었습니다.
```

## Stateless, Stateful 정리

- **무상태(**Stateless**):** 중간에 다른 점원(서버)으로 바뀌어도 된다.
    - 갑자기 클라이언트 요청이 증가해도 서버를 대거 투입할 수 있다(스케일 아웃 - 수평 확장에 유리).
    - 중간에 서버 장애가 나도 다른 서버로 대치하여 서비스를 유지할 수 있다(중계 서버를 통해 정상 작동하는 서버에 위임).
    - 즉, 무상태는 응답 서버를 쉽게 바꿀 수 있다. -> **무한한 서버 증설 가능**
- **상태 유지(**Stateful**):** 중간에 다른 점원(서버)으로 바뀌면 안된다.
    - 중간에 다른 점원으로 바뀔 때 상태 정보를 다른 점원에게 미리 알려줘야 한다.
    - 중간에 서버 장애가 발생할 경우 다른 서버로 대치하여 서비스를 유지할 수 없다(처음부터 다시 요청을 해야 한다).

## Stateless 실무 한계

모든 것을 무상태로 설계 할 수 있는 경우도 있고 없는 경우도 있다.

무상태 - 예) 로그인이 필요 없는 단순한 서비스 소개 화면

상태 유지 - 예) 로그인

- 로그인한 사용자의 경우 로그인 했다는 상태를 서버에 유지한다.
- 일반적으로 브라우저 쿠키와 서버 세션등을 사용해서(혹은 조합) 상태를 유지한다.
- 상태 유지는 최소한만 꼭 필요한 경우에만 사용한다.

## Stateless는 중요하다

서버 개발자들이 어려워하는 업무

- 정말 같은 시간에 딱 맞추어 발생하는 대용량 트래픽
- 예) 선착순 이벤트, 명절 KTX 예약, 학과 수업 등록
- 예) 저녁 6:00 선착순 1000명 치킨 할인 이벤트 -> 수만명 동시 요청

## 참조

<김영한, (강의) 모든 개발자를 위한 HTTP 웹 기본 지식, 인프런>
