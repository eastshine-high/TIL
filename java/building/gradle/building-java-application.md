**Gradle을 이용해 Java application을 만들고 Java application의 디렉토리 구조에 대해 알아보자.**

## Gradle 프로젝트 시작

 `$ gradle init` 명령은 새로운 프로젝트를 생성한다.

```bash
% gradle init

Starting a Gradle Daemon (subsequent builds will be faster)

Select type of project to generate:
  1: basic
  2: application
  3: library
  4: Gradle plugin
Enter selection (default: basic) [1..4] 2

Select implementation language:
  1: C++
  2: Groovy
  3: Java
  4: Kotlin
  5: Scala
  6: Swift
Enter selection (default: Java) [1..6] 3

Split functionality across multiple subprojects?:
  1: no - only one application project
  2: yes - application and library projects
Enter selection (default: no - only one application project) [1..2] 1

Select build script DSL:
  1: Groovy
  2: Kotlin
Enter selection (default: Groovy) [1..2] 1

Select test framework:
  1: JUnit 4
  2: TestNG
  3: Spock
  4: JUnit Jupiter
Enter selection (default: JUnit Jupiter) [1..4] 4

Project name (default: possessions): possessions
Source package (default: possessions): com.eastshine.possessions

> Task :init
Get more help with your project: https://docs.gradle.org/7.1.1/samples/sample_building_java_applications.html

BUILD SUCCESSFUL in 31m 16s
2 actionable tasks: 2 executed
```

명령어를 실행하면 무엇을 만들 것인지, 어떤 언어로 만들 것인지, 빌드 스크립트는 무엇으로 만들 것인지, 테스트 프레임워크는 무엇으로 만들 것인지 등을 물어본다. package는 보통 도메인 주소를 거꾸로 하는 방식으로 만든다.

### 프로젝트를 생성하면, 다음과 같이 폴더 구조가 생긴 것을 확인할 수 있다.

(Maven 또한 main, test로 디렉토리로 나뉜 구조로 생성된다)

```
% tree .
.
├── app
│   ├── build.gradle
│   └── src
│       ├── main
│       │   ├── java
│       │   │   └── com
│       │   │       └── eastshine
│       │   │           └── possessions
│       │   │               └── App.java
│       │   └── resources
│       └── test
│           ├── java
│           │   └── com
│           │       └── eastshine
│           │           └── possessions
│           │               └── AppTest.java
│           └── resources
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew
├── gradlew.bat
└── settings.gradle
```

## 프로젝트 파일에 대한 설명

### settings.gradle (전체 프로젝트에 대한 그레이들 설정)

`settings.gradle`의 내용을 보면 두 줄의 코드를 볼 수 있다.

```groovy
rootProject.name = 'possessions'
include('app')
//include를 통해 프로젝트들을 늘려나갈 수 있음.
```

- rootProject.name : 빌드의 이름을 지정한다.
- include('app') : 빌드는 하위 프로젝트들로 구성되는데, `app`이 실제 빌드 로직 코드를 가지고 있음을 정의한다.

### ~/app/build.gradle (app프로젝트에 관한 그레이들 설정)

```groovy
plugins {
    1.
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'
}

repositories {
    2.
    // Use Maven Central for resolving dependencies.
    mavenCentral()
}

dependencies {
    3.
    // Use JUnit Jupiter for testing.
    testImplementation 'org.junit.jupiter:junit-jupiter:5.7.1'
    4.
    // This dependency is used by the application.
    implementation 'com.google.guava:guava:30.1-jre'
}

5.
application {
    // Define the main class for the application.
    mainClass = 'com.eastshine.possessions.App'
}

6.
tasks.named('test') {
    // Use JUnit Platform for unit tests.
    useJUnitPlatform()
}
```

1. `application plugin`이 Java에서 CLI application을 빌드하기 위한 지원(support)을 추가하도록 한다.
    - ref : [https://docs.gradle.org/current/userguide/application_plugin.html](https://docs.gradle.org/current/userguide/application_plugin.html)
2. 의존성들을 보관하기 위해 Maven Central을 사용한다.
    - ref : [https://docs.gradle.org/current/userguide/declaring_repositories.html](https://docs.gradle.org/current/userguide/declaring_repositories.html)
3. 테스트에서 실제 컴파일할 때 사용.
4. 어플리케이션이 사용하는 의존성(컴파일할 때 사용).
    - dependencies ref : [https://docs.gradle.org/current/userguide/java_plugin.html](https://docs.gradle.org/current/userguide/java_plugin.html)
5. 어플리케이션의 main 클래스를 정의한다.
6. 단위 테스트들을 위해 JUnit Platform을 사용한다.

### ~/app/src/main/java/com/eastshine/possessions/App.java

```bash
/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package demo;

public class App {
    public String getGreeting() {
        return "Hello World!";
    }

    public static void main(String[] args) {
        System.out.println(new App().getGreeting());
    }
}
```

- `app` 프로젝트의 main 클래스이다.

### .gradle : 그레이들 설정 디렉토리

### .idea : 인텔리J 설정 디렉토리(참고)

(위와 같은 설정 경로는 `.gitignore`에 등록하자)

### gradlew.bat : 윈도우용 빌드 실행 파일

### gradlew : mac, linux용 빌드 및 실행 파일

## application 실행

application plugin 덕분에 `run` 명령어를 사용하면 Gradle은 mainClass에 있는 main 메소드를 실행한다.

```bash
$./gradlew run

Starting a Gradle Daemon, 1 incompatible Daemon could not be reused, use --status for details

> Task :app:run
Hello World!

BUILD SUCCESSFUL in 7s
```

## Bundle the application

application plugin은 또한 모든 의존성들을 묶는다.

```bash
$ ./gradlew build

BUILD SUCCESSFUL in 0s
7 actionable tasks: 7 executed
```

빌드가 성공하면, Gradle은 두 형태의 묶음(archive)을 만든다(app/build/distributions/app.tar and app/build/distributions/app.zip).

### Cf. 커멘드 라인에서 IntelliJ로 현재 디렉토리 실행하기

IntelliJ 설정 방법

[https://emmanuelbernard.com/blog/2017/02/27/start-intellij-idea-command-line/](https://emmanuelbernard.com/blog/2017/02/27/start-intellij-idea-command-line/)

[https://www.jetbrains.com/help/idea/opening-files-from-command-line.html](https://www.jetbrains.com/help/idea/opening-files-from-command-line.html)

```bash
$ idea .
```

(위와 같은 방식이 아닌 인텔리제이 파일 열기로도 실행 가능)

### 참조

[https://docs.gradle.org/current/samples/sample_building_java_applications.html](https://docs.gradle.org/current/samples/sample_building_java_applications.html)
