# 역참조(Backreferences)

## 역참조 이해하기

HTML 개발자는 웹 페이지에서 헤더 텍스트를 정의하고 만들고자, 헤더 태그를 사용한다. `<h1>`부터 `<h6>`까지 있으며, 이에 대응하는 종료 태그를 함께 사용한다. 단계에 상관없이 헤더를 모두 찾아야 한다고 생각해 보자. 다음 예제를 보자.

```html
<body>
	<h1>title</h1>
	this is title
	<h2>contents title</h2>
	contents
	<h2>footer</h3>
	ending
</body>
```

정규 표현식

```
<[hH][1-6]>.*?<\/[hH][1-6]>
```

이 정규식의 문제는 `<h2>footer</h3>`도 찾는다는 것이다. **문제는 종료 태그가 일치할 때 시작 태그가 어떤 텍스트인지 알 수 있는 정보가 없다는 점이다.** 이 경우에 역참조가 매우 유용하다.

## 역참조(Backreferences)

역참조라는 용어는 앞에 나온 표현(항목들)을 역으로 가리킨다는 사실을 나타낸다. 이제 역참조를 사용하여 이 문제를 개선해 보자.

```
<[hH]([1-6])>.*?<\/[hH]\1>
```

**이 패턴에서 마지막 부분인 `\1`은 앞서 일치한 하위 표현식을 참조함을 의미**하고, 따라서 `([1-6])`과 일치한 문자는 `\1`과도 일치한다. `\1`은 패턴에서 처음 사용한 하위 표현식과 일치한다는 뜻이다. \2는 두 번째, 그리고 \3은 세 번째 사용한 하위 표현식과 일치하는 식이다. 여기서 나오는 하위 표현식은 반복해 일치시키려고 사용한 것이 아니다. 여기서는 나중에 일치한 부분을 사용할 수 있도록 표시하여 구별하고자 하위 표현식을 사용했다.

> 역참조 문법은 프로그래밍 언어에 따라서 다른 방식으로 표현될 수 있다. 예를 들어 자바스크립트에서는 역참조를 표시할 때는 역슬래시(`\1`)를 사용하는데 치환 작업을 할 때는 달러 기호(`$1`)를 사용한다. 이는 vi 에디터에서도 사용한다. 펄은 달러 기호(`$`)를 사용하므로 `\1` 대신 `$1`로 표시한다.
> 

## 치환작업 수행하기

정규표현식은 검색만 할 수 있는 것이 아니다. 정규 표현식으로 강력한 치환 작업도 수행할 수 있다. 정규 표현식을 써 치환하는 박업은 역참조와 함께 사용했을 때 진가를 발휘한다. 

### Case 1

만약 텍스트에 포함된 이메일 주소에 링크(a태그 사용)를 걸고 싶다면 어떻게 해야 할까?

```
Hello, ben@forta.com is my email address.
```

정규 표현식

`(\w+[\w\.]*@[\w\.]+\.\w+)`

치환

`<a href=”mailto:$1”>$1</a>`

결과

```
Hello, <a href=”mailto:ben@forta.com">ben@forta.com</a> is my email address.
```

### Case 2

사용자 정보를 저장하는 데이터베이스에 전화번호가 313-555-1234 형식으로 저장되어 있다. 하지만 이 전화번호를 (313) 555-1234 같은 형식으로 변환해야 한다.

```
313-555-1234
```

정규 표현식

`(\d{3})(-)(\d{3})(-)(\d{4})`

치환

`($1) $3-$5`

결과

```
(313) 555-1234
```

## 참조

<벤 포터, 손에 잡히는 10분 정규식, 인사이트>
