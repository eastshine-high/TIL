# Docker

Docker사에서 2013년에 만든 컨테이너 관리도구로, 컨테이너 관리 기능 외에도 컨테이너를 실행하는 데 필요한 이미지를 만들거나 공유하는 등의 다양한 기능을 제공합니다. 도커는 사용자가 명령어를 입력하는 명령어 도구(CLI)와 명령을 받아들이는 도커 데몬으로 구성돼 있습니다.

오래전부터 유닉스라 리눅스는 하나의 호스트 운영 체제 안에서 자원을 분리해 할당하고, 실행되는 프로세스를 격리해서 관리하는 방법을 제공했습니다. 하지만 파일 시스템을 설정하고 자원과 공간을 관리하는 등의 복잡한 과정을 직접 수행해야 해서 일부 전문가만 사용할 수 있다는 단점이 있었습니다. 이런 복잡한 과정을 쉽게 만들어 주는 도구로 등장한 것이 Docker입니다. 따라서 Docker는 리눅스를 기본 Host OS로 사용합니다.

## 컨테이너

**컨테이너는 하나의 운영 체제 안에서 커널을 공유하며 개별적인 실행 환경을 제공하는 격리된 공간입니다.** 여기서 개별적인 실행 환경이란 **CPU, 네트워크, 메모리와 같은 시스템 자원을 독자적으로 사용**하도록 할당된 환경을 말합니다. 개별적인 실행 환경에서는 실행되는 프로세스를 구분하는 ID도 컨테이너 안에 격리돼 관리됩니다. 그래서 각 컨테이너 내부에서 실행되는 애플리케이션들은 서로 영향을 미치지 않고 독립적으로 작동할 수 있습니다.

## 왜 사용할까

개발하는 환경과 배포 실행하는 환경을 일치시키기([https://bcho.tistory.com/1224](https://bcho.tistory.com/1224)) 위해서입니다. 이것이 달라질 때 마다 문제가 자주 생깁니다. 그래서 도커라는 것은 배포를 할 때 실행할 어플리케이션 뿐 아니라 애플리케이션이 실행되는 환경까지 같이 배포합니다. 이를 통해 개발환경과 실행환경의 차이를 없애려는 것이 컨테이너 기술을 사용하는 이유 중의 하나입니다.

## Image

이미지는 **컨테이너 실행에 필요한 파일과 설정값등을 포함하고 있는 것**으로 상태값을 가지지 않고 변하지 않습니다(Immutable). 컨테이너는 이미지를 실행한 상태라고 볼 수 있고 추가되거나 변하는 값은 컨테이너에 저장됩니다. 같은 이미지에서 여러개의 컨테이너를 생성할 수 있고 컨테이너의 상태가 바뀌거나 컨테이너가 삭제되더라도 이미지는 변하지 않고 그대로 남아있습니다.

## Layer

도커 이미지는 컨테이너를 실행하기 위한 모든 정보를 가지고 있기 때문에 보통 용량이 수백메가MB에 이릅니다. 처음 이미지를 다운받을 땐 크게 부담이 안되지만 기존 이미지에 파일 하나 추가했다고 수백메가를 다시 다운받는다면 매우 비효율적일 수 밖에 없습니다.

도커는 이런 문제를 해결하기 위해 **레이어(layer)**라는 개념을 사용하고 유니온 파일 시스템을 이용하여 여러개의 레이어를 하나의 파일시스템으로 사용할 수 있게 해줍니다. 이미지는 여러개의 읽기 전용 read only 레이어로 구성되고 파일이 추가되거나 수정되면 새로운 레이어가 생성됩니다. ubuntu 이미지가 `A` + `B` + `C`의 집합이라면, ubuntu 이미지를 베이스로 만든 nginx 이미지는 `A` + `B` + `C` + `nginx`가 됩니다. webapp 이미지를 nginx 이미지 기반으로 만들었다면 예상대로 `A` + `B` + `C` + `nginx` + `source` 레이어로 구성됩니다. webapp 소스를 수정하면 `A`, `B`, `C`, `nginx` 레이어를 제외한 새로운 `source(v2)` 레이어만 다운받으면 되기 때문에 굉장히 효율적으로 이미지를 관리할 수 있습니다.

![https://subicura.com/assets/article_images/2017-01-19-docker-guide-for-beginners-1/image-layer.png](https://subicura.com/assets/article_images/2017-01-19-docker-guide-for-beginners-1/image-layer.png)

컨테이너를 생성할 때도 레이어 방식을 사용하는데 기존의 이미지 레이어 위에 읽기/쓰기read-write 레이어를 추가합니다. 이미지 레이어를 그대로 사용하면서 컨테이너가 실행중에 생성하는 파일이나 변경된 내용은 읽기/쓰기 레이어에 저장되므로 여러개의 컨테이너를 생성해도 최소한의 용량만 사용합니다.

### 이미지 경로

![https://subicura.com/assets/article_images/2017-01-19-docker-guide-for-beginners-1/image-url.png](https://subicura.com/assets/article_images/2017-01-19-docker-guide-for-beginners-1/image-url.png)

이미지는 url 방식으로 관리하며 태그를 붙일 수 있습니다. ubuntu 14.04 이미지는 `docker.io/library/ubuntu:14.04` 또는 `docker.io/library/ubuntu:trusty` 이고 `docker.io/library`는 생략가능하여 `ubuntu:14.04` 로 사용할 수 있습니다. 이러한 방식은 이해하기 쉽고 편리하게 사용할 수 있으며 태그 기능을 잘 이용하면 테스트나 롤백도 쉽게 할 수 있습니다.

### 이미지 검색하고 내려받기

이미지는 레지스트리(registry)라고 하는 저장소에 모여 있습니다. 레지스트리는 도커 허브([https://hub.docker.com](https://hub.docker.com/))처럼 공개된 유명 레지스트리일 수도 있고, 내부에 구축한 레지스트리일 수도 있습니다. 별도의 레지스트리를 지정하지 않으면 기본으로 도커 허브에서 이미지를 찾습니다.

`docker search <검색어>`를 입력하면 특정한 이름(검색어)을 포함하는 이미지가 있는지 찾습니다.

`docker search`로 찾은 이미지는 `docker pull`로 내려받을 수 있습니다.

---

### 참조

[https://cultivo-hy.github.io/docker/image/usage/2019/03/14/Docker정리/](https://cultivo-hy.github.io/docker/image/usage/2019/03/14/Docker%EC%A0%95%EB%A6%AC/)

<조훈 심근우 문성주, 컨테이너 인프라 환경 구축을 위한 쿠버네티스 / 도커, 길벗>
